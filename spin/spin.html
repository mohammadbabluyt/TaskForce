<!DOCTYPE html>
<html lang="en">
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>Spin & Earn</title>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
<style>
  body{margin:0;padding:0;background:#0f172a;color:#fff;font-family:Arial,sans-serif;text-align:center;}
  h1{padding:20px;color:#22d3ee;}
  .wheel-container{position:relative;margin:auto;width:250px;height:250px;}
  #wheel{width:100%;height:100%;border-radius:50%;background:conic-gradient(
      #10b981 0deg 45deg,#3b82f6 45deg,#f59e0b 90deg,#ef4444 135deg,
      #6366f1 180deg,#14b8a6 225deg,#e11d48 270deg,#84cc16 315deg
    );border:5px solid #fff;transition:transform 4s ease-out;}
  .pointer{position:absolute;top:-20px;left:50%;transform:translateX(-50%) rotate(180deg);
    width:0;height:0;border-left:20px solid transparent;border-right:20px solid transparent;
    border-top:30px solid #22d3ee;}
  button,input{margin:10px;padding:10px 20px;font-size:16px;background:#22d3ee;color:#000;border:none;border-radius:6px;cursor:pointer;}
  #wallet,#result{margin:10px;font-size:18px;}
</style>
</head>
<body>

<h1>Spin & Earn</h1>
<button id="googleBtn">Sign in with Google</button>
<div id="app" style="display:none;">
  <div id="wallet">Points: 0</div>
  <div class="wheel-container">
    <div class="pointer"></div>
    <div id="wheel"></div>
  </div>
  <button id="spinBtn">SPIN (Watch Ad)</button>
  <div id="result"></div>
  <input type="number" id="redeemAmt" placeholder="Redeem points">
  <button id="redeemBtn">Redeem</button>
</div>

<script>
  // ðŸ”§ à§§. à¦†à¦ªà¦¨à¦¾à¦° Firebase à¦ªà§à¦°à§‹à¦œà§‡à¦•à§à¦Ÿà§‡à¦° à¦®à¦¾à¦¨ à¦¬à¦¸à¦¾à¦¨ à¦à¦–à¦¾à¦¨à§‡:
  const firebaseConfig = {
    apiKey: "YOUR_API_KEY",
    authDomain: "YOUR_AUTH_DOMAIN",
    projectId: "YOUR_PROJECT_ID",
    storageBucket: "YOUR_STORAGE_BUCKET",
    messagingSenderId: "YOUR_MSG_ID",
    appId: "YOUR_APP_ID"
  };
  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth(), db = firebase.firestore();

  const googleBtn=document.getElementById('googleBtn'),
        appDiv=document.getElementById('app'),
        walletDiv=document.getElementById('wallet'),
        spinBtn=document.getElementById('spinBtn'),
        resultDiv=document.getElementById('result'),
        redeemBtn=document.getElementById('redeemBtn');

  const segments=["5","10","15","20","Miss","50","100","25"],
        angle=360/segments.length, maxSpins=5;
  let uid="", rotation=0, spinning=false;

  // ðŸ” Google Login
  googleBtn.onclick = async () => {
    const provider=new firebase.auth.GoogleAuthProvider();
    const cred=await auth.signInWithPopup(provider);
    uid = cred.user.uid;
    googleBtn.style.display='none';
    appDiv.style.display='block';
    updateWallet();
  };

  // ðŸ§¾ Wallet Update
  async function updateWallet(){
    const doc = await db.collection('users').doc(uid).get();
    if(!doc.exists) await db.collection('users').doc(uid).set({points:0,spins:{},redeems:[]});
    const data = (await db.collection('users').doc(uid).get()).data();
    walletDiv.innerText = `Points: ${data.points || 0}`;
  }

  // ðŸ“º Ad placeholder
  function showAd(cb){
    alert("âœ… Ad finished!"); cb();
  }

  // ðŸŽ¡ Spin logic
  spinBtn.onclick = async () => {
    if(spinning) return;
    spinning=true; resultDiv.innerText="Spinning...";
    const today = new Date().toISOString().slice(0,10);
    const doc = await db.collection('users').doc(uid).get();
    const data = doc.data();
    const used = data.spins?.[today] || 0;
    if(used >= maxSpins){ resultDiv.innerText="Today's limit reached!"; spinning=false; return; }

    showAd(async ()=>{
      const ri = Math.floor(Math.random()*segments.length);
      const stop=(360*5)+(360-(ri*angle+angle/2));
      rotation = (rotation + stop) % 3600;
      document.getElementById('wheel').style.transform=`rotate(${rotation}deg)`;

      setTimeout(async ()=>{
        const val = segments[ri];
        const pts = val==="Miss"?0:parseInt(val);
        resultDiv.innerText = val==="Miss"?"ðŸ˜¢ Try again!":`ðŸŽ‰ Won ${val} pts!`;
        const ref = db.collection('users').doc(uid);
        await ref.update({
          points: firebase.firestore.FieldValue.increment(pts),
          [`spins.${today}`]: firebase.firestore.FieldValue.increment(1)
        });
        updateWallet();
        spinning=false;
      },4000);
    });
  };

  // ðŸ’³ Redeem logic
  redeemBtn.onclick = async ()=>{
    const amt = parseInt(document.getElementById('redeemAmt').value);
    if(!amt) return alert("Enter amount!");
    const ref=db.collection('users').doc(uid);
    const pts=(await ref.get()).data().points;
    if(amt>pts){ alert("Not enough points!"); return; }
    await ref.update({
      points: firebase.firestore.FieldValue.increment(-amt),
      redeems: firebase.firestore.FieldValue.arrayUnion({amount:amt,date:new Date()})
    });
    alert(`Redeem request: ${amt} pts`);
    updateWallet();
  };
</script>
</body>
</html>
